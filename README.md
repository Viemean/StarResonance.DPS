# Star Resonance DPS Meter

![应用截图](Assets/img.png)

一个为《星痕共鸣》设计的轻量级数据统计悬浮窗工具。

本工具作为前端界面，通过连接到强大的后端服务 **StarResonanceDamageCounter**，可以实时抓取和展示精细的战斗数据，帮助玩家深度分析团队输出、治疗、承伤、技能分布等关键指标。

## ⚠️ 重要：运行前提

本程序是一个**纯前端显示工具**，**必须** 先下载并运行其后端数据抓取服务才能正常工作。

1.  **安装后端服务 (必需)**
    * 请前往后端项目的 Releases 页面：[**dmlgzs/StarResonanceDamageCounter/releases**](https://github.com/dmlgzs/StarResonanceDamageCounter/releases)
    * 下载最新版本的 `star-resonance-damage-counter.exe`**先运行它**。

2.  **安装 .NET 运行时 (必需)**
    * 本应用基于 .NET 9 框架。请先[点击此处安装最新的 .NET 9.0 桌面运行时](https://dotnet.microsoft.com/zh-cn/download/dotnet/thank-you/runtime-desktop-9.0.8-windows-x64-installer) 

3.  **下载并运行本应用**
    * 前往本项目的 [GitHub Releases](https://github.com/Viemean/StarResonance.DPS/releases) 页面下载运行。

## ✨ 核心功能

### 📊 实时数据监控与统计

* **团队数据概览**: 统计团队中所有成员的 `总伤害`, `总治疗`, `总DPS`, `总HPS` 和 `总承伤`。
* **团队排行与占比**: 自动根据选定指标（默认为总DPS）对团队成员进行排名，并直观显示每个玩家在团队总伤害/总治疗中的贡献百分比。
* **智能闲置模式(可选)**: 长时间（超过30秒）无数据变化的玩家将被自动标记为“闲置”状态，其排名会沉底显示，并且其数据将**不计入**团队总伤的百分比统计，确保统计口径的准确性。
* **表头统计**: 鼠标悬停在列表的各个表头（如“总伤害”、“总DPS”）上时，会显示当前所有**非闲置**玩家在该项数据上的总和与格式化数值。

### 🎯 深度技能与玩家分析

* **技能详情展开**: 双击任意玩家行，即可展开显示该玩家伤害最高的6个技能的详细数据，包括技能名称、伤害/治疗量及其在玩家总输出中的占比。
* **详细玩家Tooltip**: 鼠标悬停在玩家昵称上时，会浮现一个信息工具提示，展示该玩家的 `等级`, `职业`, `ID`, `暴击率`, `幸运率` 等后端服务提供的详细统计信息。
* **数据精确搜索**: 内置搜索功能，可以根据 `玩家名称` (模糊搜索) 或 `玩家ID` (精确匹配) 快速筛选列表中的玩家。

### ⚙️ 战斗控制与管理

* **暂停/恢复**: 可随时暂停和恢复数据的统计。暂停期间，战斗计时器也会停止。
* **数据重置**: 一键清空当前所有统计数据，并向后端服务发送重置指令，开始一次全新的战斗记录。
* **战斗倒计时**: 提供1分钟、5分钟或自定义时长（最长60分钟）的战斗倒计时功能。倒计时结束后会自动暂停统计，非常适合用于精准的木桩测试或副本竞速计时。
* **快照系统 (Snapshot)**:
    * **保存快照**: 可以将当前的完整战斗数据（包括所有玩家的详细技能数据）保存为一个 `.json` 文件，以便日后分析。
    * **加载快照**: 加载之前保存的快照文件，可以**完全复现**当时的战斗场景和数据。在快照模式下，程序会**默认暂停**实时数据的接收，让您可以安心分析历史记录。

### 🎨 高度自定义的界面

* **界面锁定与鼠标穿透**: 可一键锁定窗口位置和大小，避免误触。锁定后将开启**鼠标穿透**模式，可以直接点击到覆盖的游戏画面。
* **窗口调节**:
    * **字体样式**: 自由更换为系统已安装的任意字体。
    * **字体大小**: 从 10px 到 24px 自由缩放。
    * **窗口透明度**: 通过滑动条实时调整窗口透明度
* **性能自定义**:
    * **UI刷新率**: 可根据性能需求，选择不同的UI刷新间隔（默认为500ms）
    * **后端地址**: 支持自定义后端服务地址，默认为 `ws://localhost:8989`。

### 🌐 便捷操作与本地化

* **多语言支持**: 内置**简体中文**、**英语**、**日语**三种语言（机翻），可在设置中随时一键切换，无需重启。
* **数据导出与复制**:
    * **快速复制**: 单击玩家排名的序号，即可快速复制该玩家的单行统计数据到剪贴板。
* **系统托盘**: 支持最小化到系统托盘。关闭主窗口时，程序仍在后台运行，双击托盘图标或右键菜单可恢复窗口。
* **状态保存**: 程序会自动保存并加载你的设置，包括窗口位置、大小、透明度、字体、排序规则以及各项开关等，下次启动时无需重新配置。

## 📖 使用说明

### 顶部标题栏

* **左侧**:
    * `💾`: 保存快照，将当前所有战斗数据（包括技能）记录到 `.json` 文件。
    * `📂`: 加载快照，读取 `.json` 文件以复现战斗数据。
    * `HH:MM:SS`: 显示当前系统时间。
* **中间**:
    * `暂停/恢复`: 控制数据的抓取和计时。
    * `重置`: 清空所有数据。
    * `已连接/已断开`: 显示与后端服务的连接状态。
    * `XX:XX`: 显示战斗计时或倒计时。
    * `🕒`: 点击启动战斗倒计时。
* **右侧**:
    * `—`: 最小化到系统托盘。
    * `🔓/🔒`: 解除/锁定窗口。
    * `⚙️`: 打开/关闭下方的设置面板。

### 玩家列表

* **表头排序**: 点击"总伤害"、"总DPS"等表头可以对列表进行升序/降序排列。
* **双击展开**: 双击任意玩家行可以展开/折叠该玩家的技能详情。
* **悬浮提示**: 鼠标悬停在玩家昵称或数值上会显示更详细的原始数据和统计信息。

### 设置面板

* **闲置模式与退出暂停**: 勾选以启用相应功能。"退出时暂停服务"选项可以在关闭DPS工具时，自动暂停后端服务的数据抓取，方便下次启动时继续。
* **后端服务地址**: 如果你的后端服务运行在不同端口，请在此处修改并点击“连接”。
* **语言**: 在下拉菜单中选择界面语言，立即生效。